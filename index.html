<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hardware Fix AI - Fix Any Device</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{--bg:#0f0f0f;--text:#ffffff;--primary:#ff4b4b;--card:#1a1a1a;--input:#2d2d2d;--border:#333}
    body{margin:0;padding:0;font-family:'Inter',sans-serif;background:linear-gradient(135deg,#000,#111);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
    header{text-align:center;padding:40px 20px 20px}
    h1{font-size:48px;margin:0;background:linear-gradient(90deg,#ff4b4b,#ff8f8f);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .subtitle{font-size:20px;opacity:0.8}
    .container{max-width:900px;margin:auto;padding:20px;flex:1}
    .setup{background:var(--card);padding:20px;border-radius:16px;margin-bottom:20px;border:1px solid var(--border);text-align:center}
    input[type="password"], #userInput{width:100%;padding:14px;background:var(--input);border:1px solid var(--border);border-radius:12px;color:white;font-size:16px}
    .chat-container{background:var(--card);border-radius:16px;height:65vh;overflow-y:auto;padding:20px;border:1px solid var(--border);margin-bottom:20px}
    .message{margin:15px 0;padding:12px 18px;border-radius:18px;max-width:85%;line-height:1.5;word-wrap:break-word}
    .user{background:var(--primary);margin-left:auto;border-bottom-right-radius:4px;color:white}
    .ai{background:#333;margin-right:auto;border-bottom-left-radius:4px}
    .input-area{display:flex;gap:10px;background:var(--card);padding:15px;border-radius:16px;border:1px solid var(--border)}
    button{padding:14px 24px;background:var(--primary);color:white;border:none;border-radius:12px;cursor:pointer;font-weight:600}
    button:hover{opacity:0.9;transform:translateY(-1px)}
    button:disabled{opacity:0.5;cursor:not-allowed}
    footer{text-align:center;padding:30px;opacity:0.6;font-size:14px}
    .typing{opacity:0.7;font-style:italic}
    a.button{display:inline-block;margin:10px;padding:12px 20px;background:#ff4b4b;color:white;border-radius:12px;text-decoration:none;font-weight:600}
  </style>
</head>
<body>

<header>
  <h1>Hardware Fix AI</h1>
  <p class="subtitle">Fix printers, PCs, phones, cars, appliances – anything with circuits</p>
</header>

<div class="container">

  <div class="setup" id="setup">
    <strong>Get your Grok API key → <a href="https://console.x.ai" target="_blank" style="color:#ff4b4b">console.x.ai</a></strong><br><br>
    <input type="password" id="apiKey" placeholder="Paste your xai_... key here" />
    <button onclick="saveKey()">Save Key & Start Fixing</button>
  </div>

  <div id="chat" class="chat-container" style="display:none;"></div>

  <div class="input-area" id="inputArea" style="display:none;">
    <input type="text" id="userInput" placeholder="My printer is printing lines, HP OfficeJet Pro 9015e..." onkeypress="if(event.key==='Enter') sendMessage()" />
    <button onclick="sendMessage()" id="sendBtn">Send</button>
  </div>

</div>

<footer>Hardware Fix AI • Powered by Grok (xAI) • Nov 2025</footer>

<script>
  const API_BASE = "https://api.x.ai/v1";
  const MODEL = "grok-beta";

  const chatDiv = document.getElementById("chat");
  const inputArea = document.getElementById("inputArea");

  let messages = [
    { role: "system", content: `You are Hardware Fix AI – the best hardware diagnostic expert in 2025. Fix anything: printers, PCs, phones, cars, drones, appliances, servers. Be detailed, safe, and practical.` }
  ];

  function saveKey() {
    const key = document.getElementById("apiKey").value.trim();
    if (!key) return alert("Paste your API key first");
    localStorage.setItem("grok_key", key);
    document.getElementById("setup").style.display = "none";
    chatDiv.style.display = "block";
    inputArea.style.display = "flex";
    addMessage("ai", "Ready! Describe your hardware problem (brand, model, symptoms…). I fix everything.");
  }

  window.onload = () => {
    const saved = localStorage.getItem("grok_key");
    if (saved) { document.getElementById("apiKey").value = saved; saveKey(); }
  };

  async function sendMessage() {
    const text = document.getElementById("userInput").value.trim();
    if (!text || document.getElementById("sendBtn").disabled) return;

    addMessage("user", text);
    messages.push({ role: "user", content: text });
    document.getElementById("userInput").value = "";
    document.getElementById("sendBtn").disabled = true;
    const typing = addMessage("ai", "Analyzing hardware issue...", "typing");

    try {
      const response = await fetch(`${API_BASE}/chat/completions`, {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${localStorage.getItem("grok_key")}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: MODEL,
          messages: messages,
          temperature: 0.3,
          max_tokens: 4096
        })
      });

      if (!response.ok) {
        const errText = await response.text();
        let userMessage = "API error: " + response.status;

        // ←←← DETECT THE EXACT 403 CREDIT ERROR ←←←
        if (response.status === 403 && errText.includes("credits")) {
          userMessage = `
            <strong>No credits on your account</strong><br><br>
            New xAI accounts start with $0. You need to add credits once (free $5–$25 usually given instantly).<br><br>
            <a href="https://console.x.ai/team/default/billing" target="_blank" class="button">Add Credits Now (takes 10 seconds)</a><br><br>
            OR request free credits here → <a href="https://console.x.ai/team/default/credits" target="_blank" class="button">Request Free Credits</a>
          `;
        } else {
          userMessage += `<br><br>${errText.substring(0, 300)}`;
        }
        throw new Error(userMessage);
      }

      const data = await response.json();
      const reply = data?.choices?.[0]?.message?.content || "Empty reply from server";

      typing.remove();
      addMessage("ai", reply);
      messages.push({ role: "assistant", content: reply });

    } catch (err) {
      typing.remove();
      addMessage("ai", err.message);
    } finally {
      document.getElementById("sendBtn").disabled = false;
      document.getElementById("userInput").focus();
    }
  }

  function addMessage(sender, html, extraClass = "") {
    const div = document.createElement("div");
    div.className = `message ${sender} ${extraClass}`;
    div.innerHTML = html;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
    return div;
  }
</script>
</body>
</html>
